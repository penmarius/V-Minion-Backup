# === Print Control Macros ===
[gcode_macro PAUSE]
description: "Pause: safe park, cool hotend to 170C, hold bed temp"
rename_existing: PAUSE_BASE
variable_prev_hotend: 0
gcode:
    RESPOND MSG=" PAUSE: parking, cooling hotend to 170C, holding bed"

    ; Save paused state
    PAUSE_BASE

    ; Safe Z move (5 mm,  Zmax-1, never down)
    {% set z_max    = printer.configfile.config.stepper_z.position_max|float %}
    {% set cur_z    = printer.toolhead.position.z|float %}
    {% set min_safe = 5.0 %}
    {% set target_z = [cur_z, min_safe]|max %}
    {% set target_z = [target_z, z_max - 1.0]|min %}
    {% if target_z > cur_z + 0.01 %}
      G90
      G1 Z{target_z} F600
    {% endif %}

    ; Park at X10 Y180
    G1 X10 Y180 F6000

    ; Store current print target BEFORE cooling
    {% set prev_target = printer.extruder.target|float %}
    SET_GCODE_VARIABLE MACRO=PAUSE VARIABLE=prev_hotend VALUE={prev_target}

    ; Cool hotend to 170C (bed stays at slicer setpoint)
    M104 S170
    M140 S{printer.heater_bed.target|float}