# === Filament Handling Macros ===
[gcode_macro LOAD_FILAMENT]
description: "Heat and load filament (LGX Lite + Dragonfly BMO)"
# Params (optional):
#   TEMP   -> load temperature (default 220)
#   FEED   -> feed length to reach nozzle (default 30)
#   PURGE  -> purge amount after first melt (default 20)
#   F_FEED -> feed rate mm/min (default 600)
#   F_PURGE-> purge rate mm/min (default 300)
#   RETR   -> small retract after purge to prevent ooze (default 0.6)
gcode:
    {% set TEMP    = params.TEMP|default(220)|float %}
    {% set FEED    = params.FEED|default(30)|float %}
    {% set PURGE   = params.PURGE|default(20)|float %}
    {% set F_FEED  = params.F_FEED|default(600)|float %}
    {% set F_PURGE = params.F_PURGE|default(300)|float %}
    {% set RETR    = params.RETR|default(0.6)|float %}

    RESPOND MSG=" LOAD: heating to {TEMP}C"
    M109 S{TEMP}

    RESPOND MSG=" Feeding {FEED}mm to melt zone"
    G92 E0
    G1 E{FEED} F{F_FEED}

    RESPOND MSG=" Purging {PURGE}mm"
    G1 E{PURGE} F{F_PURGE}

    RESPOND MSG=" Anti-ooze retract {RETR}mm"
    G1 E-{RETR} F300

    RESPOND MSG=" Load complete"