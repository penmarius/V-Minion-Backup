# === Tuning Macros ===
# --- PID tune: BED (always auto-save) ----------------------------------------
# This macro PID tunes the heated bed at the chosen temperature and
# always saves the results to printer.cfg when finished.
#
# Usage examples:
#   PID_TUNE_BED               ; tunes at 70 C and auto-saves
#   PID_TUNE_BED T=80          ; tunes at 80 C and auto-saves
#
# Notes:
# - After SAVE_CONFIG, Klipper will restart automatically.
# - If your bed heater has a different name, add HEATER=your_heater.

[gcode_macro PID_TUNE_BED]
description: "PID tune bed with step messages; always auto-saves"
gcode:
  {% set T = params.T|default(70)|int %}
  {% set HEATER = params.HEATER|default("heater_bed") %}

  {% set msg1 = "BED PID 1/3: Starting PID_CALIBRATE HEATER=%s TARGET=%dC..." % (HEATER, T) %}
  RESPOND TYPE=echo MSG="{msg1}"
  PID_CALIBRATE HEATER={HEATER} TARGET={T}

  {% set msg2 = "BED PID 2/3: Calibration finished." %}
  RESPOND TYPE=echo MSG="{msg2}"

  {% set msg3 = "BED PID 3/3: Saving to printer.cfg (SAVE_CONFIG)..." %}
  RESPOND TYPE=echo MSG="{msg3}"
  SAVE_CONFIG