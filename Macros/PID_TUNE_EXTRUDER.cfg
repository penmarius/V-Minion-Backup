# === Tuning Macros ===
# --- PID tune: EXTRUDER (always auto-save) -----------------------------------
# This macro will PID tune the extruder at the chosen temperature and
# always save the results to printer.cfg when finished.
#
# Usage examples:
#   PID_TUNE_EXTRUDER               ; tunes at 230 C and auto-saves
#   PID_TUNE_EXTRUDER T=235         ; tunes at 235 C and auto-saves
#
# Notes:
# - After SAVE_CONFIG, Klipper will restart automatically.
# - If your extruder heater has a different name, add HEATER=your_heater.

[gcode_macro PID_TUNE_EXTRUDER]
description: "PID tune extruder with step messages; always auto-saves"
gcode:
  {% set T = params.T|default(230)|int %}
  {% set HEATER = params.HEATER|default("extruder") %}

  {% set msg1 = "EXTRUDER PID 1/3: Starting PID_CALIBRATE HEATER=%s TARGET=%dC..." % (HEATER, T) %}
  RESPOND TYPE=echo MSG="{msg1}"
  PID_CALIBRATE HEATER={HEATER} TARGET={T}

  {% set msg2 = "EXTRUDER PID 2/3: Calibration finished." %}
  RESPOND TYPE=echo MSG="{msg2}"

  {% set msg3 = "EXTRUDER PID 3/3: Saving to printer.cfg (SAVE_CONFIG)..." %}
  RESPOND TYPE=echo MSG="{msg3}"
  SAVE_CONFIG